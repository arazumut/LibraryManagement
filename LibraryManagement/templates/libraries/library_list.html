{% extends 'base.html' %}
{% load static %}

{% block title %}Kütüphaneler - Kütüphane Yönetim Sistemi{% endblock %}

{% block content %}
<!--begin::Content wrapper-->
<div class="d-flex flex-column flex-column-fluid">
    <!--begin::Toolbar-->
    <div id="kt_app_toolbar" class="app-toolbar py-3 py-lg-6">
        <!--begin::Toolbar container-->
        <div id="kt_app_toolbar_container" class="app-container container-xxl d-flex flex-stack">
            <!--begin::Page title-->
            <div class="page-title d-flex flex-column justify-content-center flex-wrap me-3">
                <!--begin::Title-->
                <h1 class="page-heading d-flex text-dark fw-bold fs-3 flex-column justify-content-center my-0">
                    Kütüphaneler
                </h1>
                <!--end::Title-->
                <!--begin::Breadcrumb-->
                <ul class="breadcrumb breadcrumb-separatorless fw-semibold fs-7 my-0 pt-1">
                    <li class="breadcrumb-item text-muted">
                        <a href="{% url 'library_list' %}" class="text-muted text-hover-primary">Ana Sayfa</a>
                    </li>
                    <li class="breadcrumb-item">
                        <span class="bullet bg-gray-400 w-5px h-2px"></span>
                    </li>
                    <li class="breadcrumb-item text-muted">Kütüphaneler</li>
                </ul>
                <!--end::Breadcrumb-->
            </div>
            <!--end::Page title-->
            <!--begin::Actions-->
            <div class="d-flex align-items-center gap-2 gap-lg-3">
                <a href="{% url 'create_library' %}" class="btn btn-sm fw-bold btn-primary">
                    <i class="ki-duotone ki-plus fs-2"></i>
                    Yeni Kütüphane
                </a>
            </div>
            <!--end::Actions-->
        </div>
        <!--end::Toolbar container-->
    </div>
    <!--end::Toolbar-->
    <!--begin::Content-->
    <div id="kt_app_content" class="app-content flex-column-fluid">
        <!--begin::Content container-->
        <div id="kt_app_content_container" class="app-container container-xxl">
            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {% endfor %}
            {% endif %}

            {% if libraries %}
                <!--begin::Row-->
                <div class="row g-6 g-xl-9">
                    {% for library in libraries %}
                        <!--begin::Col-->
                        <div class="col-md-6 col-xl-4">
                            <!--begin::Card-->
                            <div class="card h-100">
                                <!--begin::Card header-->
                                <div class="card-header border-0 pt-9">
                                    <!--begin::Card Title-->
                                    <div class="card-title m-0">
                                        <!--begin::Avatar-->
                                        <div class="symbol symbol-50px w-50px bg-light">
                                            <i class="ki-duotone ki-book fs-2x text-primary">
                                                <span class="path1"></span>
                                                <span class="path2"></span>
                                            </i>
                                        </div>
                                        <!--end::Avatar-->
                                    </div>
                                    <!--end::Card Title-->
                                    <!--begin::Card toolbar-->
                                    <div class="card-toolbar">
                                        <div class="me-0">
                                            <button class="btn btn-sm btn-icon btn-bg-light btn-active-color-primary" data-kt-menu-trigger="click" data-kt-menu-placement="bottom-end">
                                                <i class="ki-duotone ki-dots-horizontal fs-5">
                                                    <span class="path1"></span>
                                                    <span class="path2"></span>
                                                    <span class="path3"></span>
                                                </i>
                                            </button>
                                            <!--begin::Menu 3-->
                                            <div class="menu menu-sub menu-sub-dropdown menu-column menu-rounded menu-gray-800 menu-state-bg-light-primary fw-semibold w-200px py-3" data-kt-menu="true">
                                                <!--begin::Menu item-->
                                                <div class="menu-item px-3">
                                                    <a href="{% url 'library_detail' library.pk %}" class="menu-link px-3">
                                                        <i class="ki-duotone ki-eye fs-6 me-2">
                                                            <span class="path1"></span>
                                                            <span class="path2"></span>
                                                            <span class="path3"></span>
                                                        </i>
                                                        Görüntüle
                                                    </a>
                                                </div>
                                                <!--end::Menu item-->
                                                {% if request.user.is_super_admin or library.owner == request.user %}
                                                    <!--begin::Menu item-->
                                                    <div class="menu-item px-3">
                                                        <a href="{% url 'edit_library' library.pk %}" class="menu-link px-3">
                                                            <i class="ki-duotone ki-pencil fs-6 me-2">
                                                                <span class="path1"></span>
                                                                <span class="path2"></span>
                                                            </i>
                                                            Düzenle
                                                        </a>
                                                    </div>
                                                    <!--end::Menu item-->
                                                    <!--begin::Menu item-->
                                                    <div class="menu-item px-3">
                                                        <a href="{% url 'delete_library' library.pk %}" class="menu-link px-3 text-danger" onclick="return confirm('Bu kütüphaneyi silmek istediğinizden emin misiniz?')">
                                                            <i class="ki-duotone ki-trash fs-6 me-2">
                                                                <span class="path1"></span>
                                                                <span class="path2"></span>
                                                                <span class="path3"></span>
                                                                <span class="path4"></span>
                                                                <span class="path5"></span>
                                                            </i>
                                                            Sil
                                                        </a>
                                                    </div>
                                                    <!--end::Menu item-->
                                                {% endif %}
                                            </div>
                                            <!--end::Menu 3-->
                                        </div>
                                    </div>
                                    <!--end::Card toolbar-->
                                </div>
                                <!--end::Card header-->
                                <!--begin::Card body-->
                                <div class="card-body p-9">
                                    <!--begin::Name-->
                                    <div class="fs-3 fw-bold text-dark">{{ library.name }}</div>
                                    <!--end::Name-->
                                    <!--begin::Description-->
                                    {% if library.description %}
                                        <p class="text-gray-400 fw-semibold fs-5 mt-1 mb-7">{{ library.description|truncatewords:20 }}</p>
                                    {% else %}
                                        <p class="text-gray-400 fw-semibold fs-5 mt-1 mb-7">Açıklama bulunmuyor.</p>
                                    {% endif %}
                                    <!--end::Description-->
                                    <!--begin::Info-->
                                    <div class="d-flex flex-wrap mb-5">
                                        <!--begin::Due-->
                                        <div class="border border-gray-300 border-dashed rounded min-w-125px py-3 px-4 me-7 mb-3">
                                            <div class="fs-6 text-gray-800 fw-bold">{{ library.books.count }}</div>
                                            <div class="fw-semibold text-gray-400">Kitap Sayısı</div>
                                        </div>
                                        <!--end::Due-->
                                        <!--begin::Budget-->
                                        <div class="border border-gray-300 border-dashed rounded min-w-125px py-3 px-4 mb-3">
                                            <div class="fs-6 text-gray-800 fw-bold">{{ library.owner.first_name }} {{ library.owner.last_name }}</div>
                                            <div class="fw-semibold text-gray-400">Sahip</div>
                                        </div>
                                        <!--end::Budget-->
                                    </div>
                                    <!--end::Info-->
                                    <!--begin::Progress-->
                                    <div class="h-4px w-100 bg-light mb-5" data-bs-toggle="tooltip" title="Kütüphane doluluk oranı">
                                        {% if library.books.count > 0 %}
                                            <div class="bg-success rounded h-4px" style="width: {% widthratio library.books.count 100 100 %}%"></div>
                                        {% else %}
                                            <div class="bg-gray-300 rounded h-4px" style="width: 5%"></div>
                                        {% endif %}
                                    </div>
                                    <!--end::Progress-->
                                    <!--begin::Users-->
                                    <div class="symbol-group symbol-hover">
                                        <div class="symbol symbol-35px symbol-circle" data-bs-toggle="tooltip" title="{{ library.owner.first_name }} {{ library.owner.last_name }}">
                                            {% if library.owner.profile_picture %}
                                                <img alt="{{ library.owner.first_name }}" src="{{ library.owner.profile_picture.url }}" />
                                            {% else %}
                                                <div class="symbol-label bg-warning text-inverse-warning fw-bold">{{ library.owner.first_name|first }}{{ library.owner.last_name|first }}</div>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <!--end::Users-->
                                </div>
                                <!--end::Card body-->
                                <!--begin::Card footer-->
                                <div class="card-footer border-0 pt-0">
                                    <a href="{% url 'library_detail' library.pk %}" class="btn btn-sm btn-light-primary btn-active-primary w-100">
                                        Kütüphaneyi Görüntüle
                                    </a>
                                </div>
                                <!--end::Card footer-->
                            </div>
                            <!--end::Card-->
                        </div>
                        <!--end::Col-->
                    {% endfor %}
                </div>
                <!--end::Row-->
            {% else %}
                <!--begin::Empty state-->
                <div class="card">
                    <div class="card-body text-center py-20">
                        <!--begin::Illustration-->
                        <div class="mb-10">
                            <i class="ki-duotone ki-book fs-10x text-gray-300">
                                <span class="path1"></span>
                                <span class="path2"></span>
                            </i>
                        </div>
                        <!--end::Illustration-->
                        <!--begin::Label-->
                        <div class="fs-1 fw-bold text-gray-400 mb-5">Henüz kütüphane bulunmuyor</div>
                        <!--end::Label-->
                        <!--begin::Message-->
                        <div class="fs-6 text-gray-600 mb-8">
                            İlk kütüphanenizi oluşturmak için aşağıdaki butona tıklayın.
                        </div>
                        <!--end::Message-->
                        <!--begin::Action-->
                        <a href="{% url 'create_library' %}" class="btn btn-primary">
                            <i class="ki-duotone ki-plus fs-2">
                                <span class="path1"></span>
                                <span class="path2"></span>
                                <span class="path3"></span>
                            </i>
                            İlk Kütüphanenizi Oluşturun
                        </a>
                        <!--end::Action-->
                    </div>
                </div>
                <!--end::Empty state-->
            {% endif %}
        </div>
        <!--end::Content container-->
    </div>
    <!--end::Content-->
</div>
<!--end::Content wrapper-->
{% endblock %}

{% block extra_js %}
<!--begin::Vendors Javascript(used for this page only)-->
<script src="assets/plugins/custom/datatables/datatables.bundle.js"></script>
<!--end::Vendors Javascript-->
<!--begin::Custom Javascript(used for this page only)-->
<script>
    // Initialize tooltips
    document.addEventListener('DOMContentLoaded', function() {
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
        var tooltipList = tooltipTriggerList.map(function(tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl)
        })
    });
</script>
<!--end::Custom Javascript-->
{% endblock %}
